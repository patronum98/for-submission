1. 조건검사
2. 참일때 보유 포지션 조회
3. 포지션이 있으면 포지션 생성 tp/sl 도 함께 설정
4. 조건검사 참일때 포지션이 있으면 계속 조건검사


macd 조건
buyside
macd선과 macdsignal 선이 양수일때 buycross

sellside
macd선과 macdsignal 선이 양수일때 sellcross

buycross = macd > macdsignal
sellcross = macd < macdsignal



롱포지션 청산 직후에도 macd가 조건을 만족시킬때 포지션 안들어가게 만들어야함. 
상태변수를 만든다 기본값 0
롱포지션 잡으면 상태값 1로 변경 -> 롱포지션 정리후에도 1
macd가 음수값으로 변하면 0으로 변경
롱포지션은 상태값이 0 일때만 잡을수 있도록 하자.

현재 문제점
1. 보유 포지션 조회가 잘못됨. 보유포지션이 조회되는것이 아니닌 대기주문조회가 된다.
    주문이 체결되면 tp/sl은 무조건 동시에 있음. 그럼 대기주문이 있는거니까 0값이 아니게됨. 흠.. 해결 안해도 될지도..?
2. 주문이 체결되고 스탑나갔을때 tp 주문이 사라지지 않음, tp나갔을때 sl은 사라질거같은데 아직 모름
    주문 취소를 하기 위해서는 주문 아이디를 받아와야함. -> 주문길이가 2일때는 냅두고 1일때만 주문취소가 발동하도록 만들자
3. macd가 음수에서 양수로 올라올때 크로스가 아니어도 조건충족이 됨. -> macd 상태값을 만들고 macd가 크로스 될때 상태값이 변경된 다음 상태값으로 조건 검증하게 하자


조건주문에 len==0 일때가 있는데 왜 대기주문이 있을때도 주문이 걸린거지..?;;;;;;;;

주문들어갔을때 buy 메세지와 함께 수치를 보내주는 걸 만들어야겠다.

여전히 macd가 말썽이다. 크로스될때 1값이 되는게 아닌 macd>macdsignal 일때 계속 1인것.
크로스될떄 리스트에 1을 넣어주고 다음시간에 pop 시켜서 리스트에 1이 있을때만 하도록 해야하나

바꿔야 할것
1. 확정봉으로 하자.
2. macd 신호알고리즘을 바꾸자


2022/09/02
익절은 지정가로 할수있게 바꾸자 V
배율을 높이고 분할익절 하는방향도 생각중..

2022/09/03
macd의 교차지점이 아닌 단순 음양변화로도 되는지 관찰필요. 지금 전략이 승률이 너무 안좋기 때문

strategy1
종가가 1200이평 위
1200이평 각도가 양수(일정 수치 이상)
macd교차
이평각도 양수
이평 정배열

strategy2
이평정배열
이평각도가 양수
종가가 모든 이평을 뚫고 마감됬을때
익절 1.5퍼 손절 0.5퍼

strategy3
이평정배열
이평각도양수
macd가 음-> 양 일때 매수
손절 0.5 익절 2퍼


2022/09/04
s3. 익절 하고 난다음이 문제 해결방법 강구
애초에 익절을 2퍼센트로 잡는게 아니라 
롱익절 ma200 손절 ma200-0.5퍼 -> 이런식으로 하려면 틱마다 주문을 다시 제출해야 하나..? if문으로 돌파시에 주문넣는것으로 해결 가능하긴 한데 백테스트코드는 어떻게 짜야하지
숏익절 ma200 손절 ma200+0.5퍼
이런식으로 접근해보자

그리고 백테스트코드를 빨리 짜야 더 많은 전략을 빨리 정확하게 실험할수있다. 
백테스트 예시
for문에서 데이터를 다 돌리고 조건에 충족하는곳만 프린트
position 변수를 만들고 조건충족시 바뀌게 하면 될듯


2022/09/07
해결해야할 문제 or 할것
1. 시간출력이 utc라 보기에 불편함. kst나 utc+9가 되는지
2. 1500분 단위로 데이터프레임 모아서 합치는 코드 짜기
3. 백테스트 코드 완성하기


s3 전략에서 macd조건에 문제가 많음

2022/09/08
백테스트 완성..? 자동화는 아니지만 얼추 데이터를 넣어서 결과를 뽑아볼수는 있다
다양한 전략으로 테스트해보는것이 필요 -> 생각나는데로 적자
지금은 8월데이터만 있지만 상승, 하락장 데이터 필요 아마 2년치정도?

1200각도 음수일때는 숏만
차트가 1200이평보다 아래있고 이평을 다 뚫었을때 숏만친다 -> 잔잔바리가 너무 많음
손절은 1200라인


2022/09/09
롱이 들어간 상태에서 익절이 안되고 숏이 들어감 -> 둘다 익절 안된상태에서 반복문 끝. 어디가 문제지?
l_position 과 s_position을 줬던것이 문제였다. 덕분에 둘다 포지션이 들어갈수 있었던것;;;
그냥 position만 주니 잘 된다
암튼 해결

2022/09/10
1. 데이터 모을때 날짜를 timestamp로 말고 읽을수 있는 날짜로 받아서 만들자
2. 백테스트는 끝났으니 자동매매 코드를 짜야함 
3. 아니다 디테일을 잡자
    익절 후 조건만족일때 포지션이 들어가는걸 해결해야함. -> 시간이 가장 적절할것 같다. 가장 좋은 시간을 어떻게 구하지..?
4. 슬슬 서버도 알아보자

2022/10/18
거래 종료 후 바로 거래가 되는 현상을 막기위해 시간공백을 주는 코드를 짜야함.
거래가 되면 position = 1 이되고 종료가되면 0이 된다. 거래 종료시점부터 3시간 카운트를 해야함
position이 0 이 되면 그때부터 3시간짜리 스텍을 만들어서 쌓는다. 그리고 다 쌓이면 거래를 스텍을 초기화 하고 거래를 하게끔 만들어야함.
position변수로 하니 잘 안되서(?) wait 변수를 만든다음 60개 카운트 다운으로 구현 성공. 거래수도 줄고 수익은 비슷하다


스탑로스가 너무 멀리있을때가 있다. 스탑로스가 실시간으로 바뀌는 코드를 만들어야 한다. 추가로 익절나갔을때 스탑이 자동으로 사라지는 함수도 찾아보자